<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="node_modules/xterm/css/xterm.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="node_modules/xterm/lib/xterm.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/xterm.min.js"></script>
    <script src="Javascript/xterm.js"></script>
    <title>Terminal de usame</title>
  </head>
  <body>
    <!-- TODO: Botones de estado -->
    <div id="terminal"></div>
    <script>
      var term = new Terminal({
        cursorBlink: "block"
      });

      var curr_line = "";

      term.open(document.getElementById("terminal"));
      term.write("web shell $ ");

      term.prompt = () => {
        if (curr_line) {
          let data = { method: "command", command: curr_line };
          ws.send(JSON.stringify(data));
        }
      };

      term.prompt();

      /* 
        Al recibir mensajes del servidor
        term.write("\r\n" + JSON.parse(msg.data).data);
        curr_line = "";
      */

      term.on("key", function(key, ev) {
        if (ev.keyCode === 13) {
          if (curr_line) {
            term.write("\r\n");
            term.prompt();
          }
        } else if (ev.keyCode === 8) {
          if (curr_line) {
            curr_line = curr_line.slice(0, curr_line.length - 1);
            term.write("\b \b");
          }
        } else {
          curr_line += key;
          term.write(key);
        }
      });

      term.on("paste", function(data) {
        curr_line += data;
        term.write(data);
      });
    </script>
  </body>
</html>
